---
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from '@/components/ui/breadcrumb'
import { Icon } from 'astro-icon/components'

export interface BreadcrumbItem {
  href?: string
  label: string
  icon?: string
}

interface Props {
  items: BreadcrumbItem[]
}

const { items } = Astro.props

// 1. 取得基礎路徑並確保結尾沒有斜線
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<Breadcrumb>
  <BreadcrumbList>
    <BreadcrumbItem>
      <a href={`${base}/`} class="hover:text-foreground transition-colors">
        <Icon name="lucide:home" class="size-4 shrink-0" />
      </a>
    </BreadcrumbItem>
    {
      items.map((item, index) => (
        <>
          <BreadcrumbSeparator />
          <BreadcrumbItem>
            {index === items.length - 1 ? (
              <BreadcrumbPage>
                <span class="flex items-center gap-x-2">
                  {item.icon && (
                    <Icon name={item.icon} class="size-4 shrink-0" />
                  )}
                  <span>{item.label}</span>
                </span>
              </BreadcrumbPage>
            ) : (
              /* 3. 使用原生 <a> 標籤避開其他組件的干擾 */
              <a 
                href={item.href ? `${base}${item.href}` : '#'} 
                class="transition-colors hover:text-foreground flex items-center gap-x-2 text-sm"
              >
                {item.icon && (
                  <Icon name={item.icon} class="size-4 shrink-0" />
                )}
                <span>{item.label}</span>
              </a>
            )}
          </BreadcrumbItem>
        </>
      ))
    }
  </BreadcrumbList>
</Breadcrumb>